<html>
<head>
    
</head>
<body>
    <h1>Steganography Project Prototype</h1>
    <div class="border">
        <input type="radio" name="operation" value="hide" checked="true" />Hide
        <input type="radio" name="operation" value="find" />Find
    </div>
    <div class="border">
        <label for="ImageFile" id="ImageLabel">Select Haystack Image File</label>
        <input type="file" id="ImageFile" accept=".png">
    </div>
    <div class="border">
        <label for="HiddenFile" id="HiddenLabel">Select PNG/TXT File to be hidden</label>
        <input accept=".png,.txt" type="file" id="HiddenFile">
    </div>
    <div class="border">

        <label for="greedInput">Select Greed Level (1-8)</label>
        <input type="number" min="1" max="8" id="greedInput" value="1" />
    </div>

    <script src="js/libraries/download2.js"></script>
    <script src="js/libraries/pako.js"></script>
    <script src="js/libraries/UPNG.js"></script>
    <script src="js/bitManipulation.js"></script>
    <script src="js/BasicImage.js"></script>
    <script src="js/utility.js"></script>
    <script src="js/typeConvertions.js"></script>
    <script src="js/hideImage.js"></script>
    <script src="js/hideText.js"></script>
    <script src="js/findImage.js"></script>
    <script src="js/findText.js"></script>
    <script src="js/hide.js"></script>
    <script src="js/find.js"></script>

    <script>
        async function execute() {

            let greed = document.getElementById("greedInput").value;
            if(greed=="") {
                alert("Please select a greed level");
                return;
            }

            let radioButtons = document.getElementsByName("operation");
            let hide=false;
            if(radioButtons[0].checked==true) hide=true;

            let haystackBlob = document.getElementById('ImageFile').files.item(0);
            if(haystackBlob==null) {
                alert("Please select your Haystack image");
                return;
            }

            //If the user is trying to hide a file
            if(hide) {
                let needleBlob = document.getElementById('HiddenFile').files.item(0);
                if(needleBlob==null) {
                    alert("Please select a file you want to hide");
                    return;
                }

                let loadedHaystackBlob = null;
                if(needleBlob.type=="image/png") {
                    loadedHaystackBlob = await hideImageFile(haystackBlob, needleBlob, greed);
                } else if(needleBlob.type=="text/plain") {
                    loadedHaystackBlob = await hideTextFile(haystackBlob, needleBlob, greed);
                } else {
                    alert("Invalid file selected for hiding.");
                    return;
                }

                if(loadedHaystackBlob==null) {
                    alert("Your haystack image was not large enough to hide your file at the current greed level.");
                    return;
                }
                download(loadedHaystackBlob, "LoadedHaystack.png", "image/png");
            //If the user is trying to find a hidden file
            } else {
                let recoveredFile = await findFile(haystackBlob, greed);

                if(recoveredFile!=null) {
                    if(recoveredFile.type=="image/png") {
                        download(recoveredFile, "Needle.png", "image/png");
                    } else {
                        download(recoveredFile, "Needle.txt", "text/plain");
                    }
                } else {
                    alert("No hidden file was found.");
                    return;
                }
            }

        }
    </script>

    <input type="button" value="Find/Hide File" onclick="execute()" />

</body>
</html>